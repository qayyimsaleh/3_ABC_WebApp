@model ABC_WebApp.Models.LoginViewModel
@{
    ViewBag.Title = "Login";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
<style>
    body { background: linear-gradient(135deg,#f5f7fa 0%,#e8f1ff 100%); }
    main { display:flex; align-items:center; justify-content:center; padding:40px 20px; }
    .login-box { display:flex; width:100%; max-width:980px; background:#fff; border-radius:var(--radius-lg); box-shadow:var(--shadow-lg); overflow:hidden; min-height:520px; }
    .login-left { flex:1; background:linear-gradient(135deg,var(--primary) 0%,var(--secondary) 100%); color:#fff; padding:50px 40px; display:flex; flex-direction:column; justify-content:center; }
    .login-left h2 { font-size:28px; margin-bottom:16px; font-weight:600; }
    .login-left p  { font-size:15px; opacity:.9; line-height:1.6; margin-bottom:24px; }
    .feature-list  { list-style:none; margin-top:24px; }
    .feature-list li { display:flex; align-items:center; gap:12px; margin-bottom:14px; font-size:15px; }
    .feature-list li .fi { width:30px; height:30px; background:rgba(255,255,255,.2); border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    .login-right { flex:1; padding:50px 40px; display:flex; flex-direction:column; justify-content:center; }
    .login-header { text-align:center; margin-bottom:28px; }
    .login-header h2 { font-size:26px; font-weight:600; color:var(--text-dark); }
    .login-header p  { color:var(--text-light); font-size:14px; margin-top:4px; }
    .form-group { margin-bottom:20px; }
    .form-group label { display:block; font-weight:500; margin-bottom:7px; font-size:14px; }
    .input-wrap { position:relative; }
    .input-wrap i { position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--text-light); }
    .form-control { width:100%; padding:13px 14px 13px 42px; border:1px solid var(--gray-300); border-radius:var(--radius); font-size:15px; transition:var(--transition); }
    .form-control:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(0,86,179,.1); }
    .form-control.input-error { border-color:var(--error); }
    .lookup-result { padding:11px 14px; border-radius:var(--radius); margin-bottom:14px; font-size:14px; border-left:4px solid; display:none; }
    .lookup-result.found  { background:rgba(40,167,69,.1); border-color:var(--success); color:#155724; }
    .lookup-result.denied { background:rgba(220,53,69,.1); border-color:var(--error); color:#721c24; }
    .lookup-result.unknown{ background:rgba(255,193,7,.1); border-color:var(--warning); color:#856404; }
    .login-footer { text-align:center; margin-top:20px; font-size:13px; color:var(--text-light); }
    .login-footer a { color:var(--primary); font-weight:500; }
    .validation-summary { background:rgba(220,53,69,.1); border-left:4px solid var(--error); color:#721c24; padding:12px 16px; border-radius:var(--radius); margin-bottom:18px; font-size:14px; }
    @@media(max-width:860px){ .login-box{flex-direction:column;max-width:480px;} .login-left,.login-right{padding:36px 28px;} }
</style>
}

<div class="login-box fade-in">
    <!-- Left panel -->
    <div class="login-left">
        <h2>Secure Compliance Portal</h2>
        <p>Access the Anti-Bribery &amp; Corruption training and reporting system for IOI Oleochemical employees.</p>
        <ul class="feature-list">
            <li><span class="fi"><i class="fas fa-check"></i></span> Complete mandatory ABC training modules</li>
            <li><span class="fi"><i class="fas fa-check"></i></span> Access policy documents &amp; guidelines</li>
            <li><span class="fi"><i class="fas fa-check"></i></span> Track your training progress</li>
            <li><span class="fi"><i class="fas fa-check"></i></span> Admin dashboard for supervisors</li>
        </ul>
    </div>

    <!-- Right panel -->
    <div class="login-right">
        <div class="login-header">
            <h2>Employee Login</h2>
            <p>Enter your credentials to access the ABC Portal</p>
        </div>

        @if (!ViewData.ModelState.IsValid)
        {
            <div class="validation-summary">
                <i class="fas fa-exclamation-triangle"></i>
                @Html.ValidationSummary(true)
            </div>
        }

        @using (Html.BeginForm("Login", "Auth", FormMethod.Post))
        {
            @Html.AntiForgeryToken()

            <div class="form-group">
                <label>Employee ID</label>
                <div class="input-wrap">
                    <i class="fas fa-id-badge"></i>
                    @Html.TextBoxFor(m => m.Username, new { @class = "form-control", placeholder = "Enter your Employee ID", autocomplete = "off", id = "empIdInput" })
                </div>
            </div>

            <!-- Live lookup result -->
            <div class="lookup-result" id="lookupResult"></div>

            <div class="form-group">
                <label>Password</label>
                <div class="input-wrap">
                    <i class="fas fa-lock"></i>
                    @Html.PasswordFor(m => m.Password, new { @class = "form-control", placeholder = "Enter your password", id = "passwordInput" })
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Login to Portal
            </button>
        }

        <div class="login-footer">
            <p>Forgot your password? <a href="mailto:it-support@example.com">Contact IT Support (Ext. 5408)</a></p>
        </div>
    </div>
</div>

@section Scripts {
<script>
    var lookupTimer = null;
    var empInput    = document.getElementById('empIdInput');
    var result      = document.getElementById('lookupResult');
    var loginBtn    = document.getElementById('loginBtn');

    empInput.addEventListener('input', function () {
        clearTimeout(lookupTimer);
        var id = this.value.trim();
        result.style.display = 'none';
        result.className = 'lookup-result';
        loginBtn.disabled = true;

        if (id.length < 2) return;

        lookupTimer = setTimeout(function () {
            fetch('@Url.Action("LookupEmployee","Auth")?id=' + encodeURIComponent(id))
                .then(function(r){ return r.json(); })
                .then(function(d){
                    result.style.display = 'block';
                    if (!d.found) {
                        result.className = 'lookup-result unknown';
                        result.innerHTML = '<i class="fas fa-question-circle"></i> Employee ID not found in the system.';
                    } else if (d.access === '0') {
                        result.className = 'lookup-result denied';
                        result.innerHTML = '<i class="fas fa-ban"></i> <strong>Access Restricted.</strong> Please contact Admin.';
                    } else {
                        result.className = 'lookup-result found';
                        result.innerHTML = '<i class="fas fa-user-check"></i> <strong>Found:</strong> ' + d.name + ' &mdash; ' + d.department;
                        loginBtn.disabled = false;
                    }
                })
                .catch(function(){ loginBtn.disabled = false; });
        }, 400);
    });

    // Allow Enter key on password field
    document.getElementById('passwordInput').addEventListener('keydown', function(e){
        if (e.key === 'Enter') this.form.submit();
    });
</script>
}
